[Remote Thread Creation In Mstsc.Exe From Suspicious Location]
description = Detects remote thread creation in the "mstsc.exe" process by a process located in a potentially suspicious location. \
This technique is often used by attackers in order to hook some APIs used by DLLs loaded by "mstsc.exe" during RDP authentications in order to steal credentials.
search = TargetImage="*\\mstsc.exe" SourceImage IN ("*:\\Temp\\*", "*:\\Users\\Public\\*", "*:\\Windows\\PerfLogs\\*", "*:\\Windows\\Tasks\\*", "*:\\Windows\\Temp\\*", "*\\AppData\\Local\\Temp\\*")

[Potential Credential Dumping Attempt Via PowerShell Remote Thread]
description = Detects remote thread creation by PowerShell processes into "lsass.exe"
search = SourceImage IN ("*\\powershell.exe", "*\\pwsh.exe") TargetImage="*\\lsass.exe"

[Remote Thread Creation Via PowerShell In Uncommon Target]
description = Detects the creation of a remote thread from a Powershell process in an uncommon target process
search = SourceImage IN ("*\\powershell.exe", "*\\pwsh.exe") TargetImage IN ("*\\rundll32.exe", "*\\regsvr32.exe")

[Password Dumper Remote Thread in LSASS]
description = Detects password dumper activity by monitoring remote thread creation EventID 8 in combination with the lsass.exe process as TargetImage. \
The process in field Process is the malicious program. A single execution can lead to hundreds of events.
search = TargetImage="*\\lsass.exe" StartModule=""

[Rare Remote Thread Creation By Uncommon Source Image]
description = Detects uncommon processes creating remote threads.
search = SourceImage IN ("*\\bash.exe", "*\\cscript.exe", "*\\cvtres.exe", "*\\defrag.exe", "*\\dnx.exe", "*\\esentutl.exe", "*\\excel.exe", "*\\expand.exe", "*\\find.exe", "*\\findstr.exe", "*\\forfiles.exe", "*\\gpupdate.exe", "*\\hh.exe", "*\\installutil.exe", "*\\lync.exe", "*\\makecab.exe", "*\\mDNSResponder.exe", "*\\monitoringhost.exe", "*\\msbuild.exe", "*\\mshta.exe", "*\\mspaint.exe", "*\\outlook.exe", "*\\ping.exe", "*\\provtool.exe", "*\\python.exe", "*\\regsvr32.exe", "*\\robocopy.exe", "*\\runonce.exe", "*\\sapcimc.exe", "*\\smartscreen.exe", "*\\spoolsv.exe", "*\\tstheme.exe", "*\\userinit.exe", "*\\vssadmin.exe", "*\\vssvc.exe", "*\\w3wp.exe", "*\\winscp.exe", "*\\winword.exe", "*\\wmic.exe", "*\\wscript.exe")

[Remote Thread Creation By Uncommon Source Image]
description = Detects uncommon processes creating remote threads.
search = SourceImage IN ("*\\explorer.exe", "*\\iexplore.exe", "*\\msiexec.exe", "*\\powerpnt.exe", "*\\schtasks.exe", "*\\winlogon.exe") NOT ((SourceImage="*:\\Windows\\System32\\winlogon.exe" TargetImage IN ("*:\\Windows\\System32\\services.exe", "*:\\Windows\\System32\\wininit.exe", "*:\\Windows\\System32\\csrss.exe", "*:\\Windows\\System32\\LogonUI.exe")) OR (SourceImage="*:\\Windows\\System32\\winlogon.exe*" TargetParentProcessId=4) OR (SourceImage IN ("*:\\Windows\\System32\\schtasks.exe", "*:\\Windows\\SysWOW64\\schtasks.exe") TargetImage="*:\\Windows\\System32\\conhost.exe") OR (SourceImage="*:\\Windows\\explorer.exe" TargetImage IN ("*:\\Program Files (x86)\\", "*:\\Program Files\\", "*:\\Windows\\System32\\", "*:\\Windows\\SysWOW64\\")) OR TargetImage="System" OR (SourceImage="*\\msiexec.exe" TargetImage IN ("*\\AppData\\Local\\*", "*:\\Program Files (x86)\\*", "*:\\Program Files\\*"))) NOT ((SourceImage="*:\\Program Files\\internet explorer\\iexplore.exe*" SourceCommandLine="*https://*" SourceCommandLine="*.checkpoint.com/documents/*" SourceCommandLine="*SmartConsole_OLH/*" SourceCommandLine="*default.htm#cshid=*") OR (SourceImage="*:\\Program Files\\internet explorer\\iexplore.exe*" SourceParentImage="*:\\Program Files*" SourceParentImage="*\\CheckPoint\\SmartConsole\\*" SourceParentImage="*\\SmartConsole.exe*") OR (SourceImage="*\\Microsoft Office\\*" SourceImage="*\\POWERPNT.EXE" TargetImage="*:\\Windows\\System32\\csrss.exe"))

[Remote Thread Creation In Uncommon Target Image]
description = Detects uncommon target processes for remote thread creation
search = TargetImage IN ("*\\calc.exe", "*\\calculator.exe", "*\\mspaint.exe", "*\\notepad.exe", "*\\ping.exe", "*\\sethc.exe", "*\\spoolsv.exe", "*\\wordpad.exe", "*\\write.exe") NOT SourceImage="*:\\Windows\\System32\\csrss.exe" NOT (StartFunction="EtwpNotificationThread" OR SourceImage="*unknown process*" OR (SourceImage="*:\\Program Files\\VMware\\VMware Tools\\vmtoolsd.exe" StartFunction="GetCommandLineW" TargetImage IN ("*:\\Windows\\System32\\notepad.exe", "*:\\Windows\\System32\\spoolsv.exe")) OR (SourceImage="C:\\Program Files\\Xerox\\XeroxPrintExperience\\CommonFiles\\XeroxPrintJobEventManagerService.exe" StartFunction="LoadLibraryW" TargetImage="C:\\Windows\\System32\\spoolsv.exe"))
